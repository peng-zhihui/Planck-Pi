#!/bin/sh
# SPDX-License-Identifier: GPL-2.0
# description: Kprobe event with comm arguments

[ -f kprobe_events ] || exit_unsupported # this is configurable

grep -A1 "fetcharg:" README | grep -q "\$comm" || exit_unsupported # this is too old

echo 'p:testprobe _do_fork comm=$comm ' > kprobe_events
grep testprobe kprobe_events | grep -q 'comm=$comm'
test -d events/kprobes/testprobe

echo 1 > events/kprobes/testprobe/enable
( echo "forked")
grep testprobe trace | grep -q 'comm=".*"'

exit 0
